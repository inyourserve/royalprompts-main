<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .btn-floating {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            text-align: center;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            z-index: 1000;
        }
        .btn-floating i {
            line-height: 60px;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">FAQ Management</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">Categories</h2>
                    </div>
                    <div class="card-body">
                        <ul id="categoryList" class="list-group list-group-flush">
                            <!-- Categories will be dynamically added here -->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">Questions</h2>
                    </div>
                    <div class="card-body">
                        <select class="form-select mb-3" id="questionCategory">
                            <option value="">Select a category</option>
                        </select>
                        <ul id="questionList" class="list-group list-group-flush">
                            <!-- Questions will be dynamically added here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating action button -->
    <button class="btn btn-primary btn-floating" data-bs-toggle="modal" data-bs-target="#addModal">
        <i class="bi bi-plus"></i>
    </button>

    <!-- Add Modal -->
    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="category-tab" data-bs-toggle="tab" data-bs-target="#category" type="button" role="tab">Category</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="question-tab" data-bs-toggle="tab" data-bs-target="#question" type="button" role="tab">Question</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="myTabContent">
                        <div class="tab-pane fade show active" id="category" role="tabpanel">
                            <form id="categoryForm">
                                <div class="mb-3">
                                    <label for="categoryName" class="form-label">Category Name</label>
                                    <input type="text" class="form-control" id="categoryName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="categoryRole" class="form-label">Role</label>
                                    <select class="form-select" id="categoryRole" required>
                                        <option value="seeker">Seeker</option>
                                        <option value="provider">Provider</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Create Category</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="question" role="tabpanel">
                            <form id="questionForm">
                                <div class="mb-3">
                                    <label for="questionCategory" class="form-label">Category</label>
                                    <select class="form-select" id="modalQuestionCategory" required>
                                        <!-- Categories will be dynamically added here -->
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="questionText" class="form-label">Question</label>
                                    <input type="text" class="form-control" id="questionText" required>
                                </div>
                                <div class="mb-3">
                                    <label for="answerText" class="form-label">Answer</label>
                                    <textarea class="form-control" id="answerText" rows="3" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Create Question</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fetch categories and populate the select dropdowns
        async function fetchCategories() {
            const response = await fetch('/api/v1/faq/categories');
            const categories = await response.json();
            const select = document.getElementById('questionCategory');
            const modalSelect = document.getElementById('modalQuestionCategory');
            const categoryList = document.getElementById('categoryList');
            select.innerHTML = '<option value="">Select a category</option>';
            modalSelect.innerHTML = '';
            categoryList.innerHTML = '';
            categories.forEach(category => {
                const option = `<option value="${category._id}">${category.name} (${category.role})</option>`;
                select.innerHTML += option;
                modalSelect.innerHTML += option;
                categoryList.innerHTML += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${category.name} (${category.role})
                        <button class="btn btn-sm btn-danger" onclick="deleteCategory('${category._id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </li>`;
            });
        }

        // Create a new category
        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('categoryName').value;
            const role = document.getElementById('categoryRole').value;
            const response = await fetch('/api/v1/faq/categories', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name, role})
            });
            if (response.ok) {
                alert('Category created successfully');
                fetchCategories();
                document.getElementById('categoryForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
            } else {
                alert('Failed to create category');
            }
        });

        // Delete a category
        async function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                const response = await fetch(`/api/v1/faq/categories/${categoryId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Category deleted successfully');
                    fetchCategories();
                } else {
                    alert('Failed to delete category');
                }
            }
        }

        // Create a new question
        document.getElementById('questionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const category_id = document.getElementById('modalQuestionCategory').value;
            const question = document.getElementById('questionText').value;
            const answer = document.getElementById('answerText').value;
            const response = await fetch('/api/v1/faq/questions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({category_id, question, answer})
            });
            if (response.ok) {
                alert('Question created successfully');
                fetchQuestions(category_id);
                document.getElementById('questionForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
            } else {
                alert('Failed to create question');
            }
        });

        // Fetch questions for a category
        async function fetchQuestions(categoryId) {
            if (!categoryId) {
                document.getElementById('questionList').innerHTML = '<li class="list-group-item">Select a category to view questions</li>';
                return;
            }
            const response = await fetch(`/api/v1/faq/questions?category_id=${categoryId}`);
            const questions = await response.json();
            const questionList = document.getElementById('questionList');
            questionList.innerHTML = '';
            questions.forEach(question => {
                questionList.innerHTML += `
                    <li class="list-group-item">
                        <strong>Q: ${question.question}</strong>
                        <p class="mb-0">A: ${question.answer}</p>
                        <button class="btn btn-sm btn-danger float-end" onclick="deleteQuestion('${question._id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </li>`;
            });
        }

        // Delete a question
        async function deleteQuestion(questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                const response = await fetch(`/api/v1/faq/questions/${questionId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Question deleted successfully');
                    fetchQuestions(document.getElementById('questionCategory').value);
                } else {
                    alert('Failed to delete question');
                }
            }
        }

        // Initial load
        fetchCategories();

        // Update questions when category is changed
        document.getElementById('questionCategory').addEventListener('change', (e) => {
            fetchQuestions(e.target.value);
        });
    </script>
</body>
</html>