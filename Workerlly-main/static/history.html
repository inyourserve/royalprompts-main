<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Listings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Job Listings</h2>

        <!-- Tabs for Job Statuses -->
        <ul class="nav nav-tabs" id="jobStatusTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="pending-tab" data-bs-toggle="tab" href="#pending" role="tab" aria-controls="pending" aria-selected="true">Pending</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="ongoing-tab" data-bs-toggle="tab" href="#ongoing" role="tab" aria-controls="ongoing" aria-selected="false">Ongoing</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="completed-tab" data-bs-toggle="tab" href="#completed" role="tab" aria-controls="completed" aria-selected="false">Completed</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="cancelled-tab" data-bs-toggle="tab" href="#cancelled" role="tab" aria-controls="cancelled" aria-selected="false">Cancelled</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="jobStatusContent">
            <!-- Pending Jobs -->
            <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
                <div class="list-group" id="pending-jobs">
                    <!-- Job items will be dynamically inserted here -->
                </div>
            </div>

            <!-- Ongoing Jobs -->
            <div class="tab-pane fade" id="ongoing" role="tabpanel" aria-labelledby="ongoing-tab">
                <div class="list-group" id="ongoing-jobs">
                    <!-- Job items will be dynamically inserted here -->
                </div>
            </div>

            <!-- Completed Jobs -->
            <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
                <div class="list-group" id="completed-jobs">
                    <!-- Job items will be dynamically inserted here -->
                </div>
            </div>

            <!-- Cancelled Jobs -->
            <div class="tab-pane fade" id="cancelled" role="tabpanel" aria-labelledby="cancelled-tab">
                <div class="list-group" id="cancelled-jobs">
                    <!-- Job items will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-base64@3.7.2/base64.min.js"></script>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjZiYjAzMjdiY2NhOTMxMzUxYzMxNDhlIiwibW9iaWxlIjoiOTE5NTIzMzUzMzY1Iiwicm9sZXMiOlsicHJvdmlkZXIiLCJzZWVrZXIiXSwiZXhwIjoxNzI0NzUyNDUzfQ.cyvvM2ifb-1qIJQpAi38t4hxhu5tX9UMMrQnY-Hm6Bg"
        // Common headers
        const headers = {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
        };

        // Decode JWT to extract user ID
        const payload = JSON.parse(Base64.decode(token.split('.')[1]));
        const userId = payload.user_id;

        // Function to fetch and list jobs
        function fetchJobs(userId) {
            const jobStatusLists = {
                pending: document.getElementById('ending-jobs'),
                ongoing: document.getElementById('ongoing-jobs'),
                completed: document.getElementById('completed-jobs'),
                cancelled: document.getElementById('cancelled-jobs')
            };

            fetch(`http://127.0.0.1:8000/api/v1/provider/jobs/user/${userId}`, {  // Replace with your FastAPI server URL
                headers: headers,
            })
            .then(response => response.json())
            .then(data => {
                for (const status in data) {
                    if (jobStatusLists[status]) {
                        data[status].forEach(job => {
                            const jobElement = document.createElement('a');
                            jobElement.href = "#";
                            jobElement.className = "list-group-item list-group-item-action";
                            jobElement.innerHTML = `
                                <h5 class="mb-1">${job.title || 'No Title'}</h5>
                                <p class="mb-1">${job.description || 'No Description'}</p>
                                <small>${new Date(job.created_at).toLocaleDateString()}</small>
                            `;
                            jobStatusLists[status].appendChild(jobElement);
                        });
                    }
                }
            })
            .catch(error => console.error('Error fetching jobs:', error));
        }

        // Fetch jobs after decoding the token
        fetchJobs(userId);
    });
    </script>
</body>
</html>